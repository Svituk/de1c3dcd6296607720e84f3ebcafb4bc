 
# Уважаемые пользователи нашей ApiCMS
# Все коды htacces, находящиеся в коментариях (#)
# Закоментированы для тех кто работает 
# Через локальный сервер или на хостинге на базе Windows

DirectoryIndex index.php

php_flag display_startup_errors on
php_flag display_errors on
php_flag html_errors on

# MIME тип по умолчанию
# php_value default_mimetype text/html

# Магические кавычки
# php_flag magic_quotes_gpc Off
# php_flag magic_quotes_runtime Off
# php_flag magic_quotes_sybase Off

# Не создаются переменные argc и argv
# php_flag register_argc_argv Off

# Глобальные переменные
# php_flag register_globals Off

# Сессия
# php_value session.auto_start 1

# Разделитель переменных в URI
# php_value arg_separator.output "&amp;"



Options -Indexes
AddDefaultCharset UTF-8
# php_value default_charset UTF-8
# php_value upload_max_filesize 15M
# php_value post_max_size 15M


# mbstring
# Автозамена на мультибайтную кодировку
# php_value mbstring.func_overload 6

# Компрессия
# php_value zlib.output_compression 4096
# php_value zlib.output_compression_level 5

<FilesMatch "\.(?:flv|gif|jpg|jpeg|png|ico|swf|js|css|pdf)$">
Header set Cache-Control "public, max-age=2592000"
</FilesMatch>

FileETag MTime Size
# Используем только Cache-Control вместо Expires
# ExpiresActive On
# ExpiresByType image/gif "access plus 30 days"
# ExpiresByType image/jpeg "access plus 30 days"
# ExpiresByType image/png "access plus 30 days"
# ExpiresByType image/x-icon "access plus 30 days"



ErrorDocument 304 /error/304.php
ErrorDocument 400 /error/400.php
ErrorDocument 401 /error/401.php
ErrorDocument 403 /error/403.php
ErrorDocument 404 /error/404.php
ErrorDocument 406 /error/406.php
ErrorDocument 500 /error/500.php
ErrorDocument 502 /error/502.php

# Pretty URLs for user profiles: /nickname → profile.php?username=nickname
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# Exclude known top-level routes and directories
RewriteCond %{REQUEST_URI} !^/(index|auth|login|lost_pass|reg|install|design|modules|admin|mini_chat|api_forum|api_lib|files|captcha|err|error|profile|block)(/|$)
# Only single-segment ASCII nicknames
RewriteRule ^([A-Za-z0-9._-]+)$ profile.php?username=$1 [L,QSA]
<IfModule mod_headers.c>
# Убираем X-Frame-Options, используем CSP frame-ancestors
# Header always set X-Frame-Options "DENY"
Header always set X-Content-Type-Options "nosniff"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
# Убираем 'unsafe-eval' из CSP для безопасности
Header always set Content-Security-Policy "default-src 'self'; img-src 'self' data:; media-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' https://ajax.googleapis.com https://unpkg.com https://cdn.jsdelivr.net https://esm.sh; connect-src 'self' https://unpkg.com https://cdn.jsdelivr.net https://esm.sh; frame-src 'self' https://www.youtube.com https://youtube.com; frame-ancestors 'none'"
# Убираем X-Powered-By если он установлен
Header unset X-Powered-By
# Убираем Pragma если он установлен
Header unset Pragma
</IfModule>
