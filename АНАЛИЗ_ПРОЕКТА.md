# –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ ApiCMS

## üìä –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞:** –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π PHP CMS (Content Management System)  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –û–û–ü  
**–í–µ—Ä—Å–∏—è:** 3.0  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** MySQL (mysqli)  
**–Ø–∑—ã–∫:** PHP

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

```
ApiCmsLast/
‚îú‚îÄ‚îÄ api_core/              # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ apicms_system.php  # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ api_connect.php    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ classes/           # –ö–ª–∞—Å—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îÇ       ‚îî‚îÄ‚îÄ security/
‚îÇ           ‚îú‚îÄ‚îÄ Escaper.php    # ‚úÖ –ö–ª–∞—Å—Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å—Ç—å)
‚îÇ           ‚îî‚îÄ‚îÄ filter.php     # ‚úÖ –ö–ª–∞—Å—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–µ—Å—Ç—å)
‚îú‚îÄ‚îÄ admin/                 # –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îú‚îÄ‚îÄ api_forum/             # –ú–æ–¥—É–ª—å —Ñ–æ—Ä—É–º–∞
‚îú‚îÄ‚îÄ api_lib/               # –ú–æ–¥—É–ª—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏/—Å—Ç–∞—Ç–µ–π
‚îú‚îÄ‚îÄ modules/               # –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ (–Ω–æ–≤–æ—Å—Ç–∏, –ø–æ—á—Ç–∞ –∏ —Ç.–¥.)
‚îú‚îÄ‚îÄ mini_chat/             # –ú–∏–Ω–∏-—á–∞—Ç
‚îú‚îÄ‚îÄ guest/                 # –ì–æ—Å—Ç–µ–≤–∞—è –∫–Ω–∏–≥–∞
‚îú‚îÄ‚îÄ design/                # –®–∞–±–ª–æ–Ω—ã –∏ —Å—Ç–∏–ª–∏
‚îî‚îÄ‚îÄ files/                 # –ó–∞–≥—Ä—É–∂–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã (–∞–≤–∞—Ç–∞—Ä—ã)
```

---

## üîç –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **CSRF –∑–∞—â–∏—Ç–∞** (–±–∞–∑–æ–≤–∞—è)
   - –§—É–Ω–∫—Ü–∏–∏ `csrf_token()` –∏ `csrf_check()` –≤ `apicms_system.php`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ö (login, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

2. **Session –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - `session.cookie_httponly = 1`
   - `session.cookie_samesite = Lax`
   - `session.cookie_secure = 1` (–ø—Ä–∏ HTTPS)

3. **–ë–∞–∑–æ–≤–æ–µ SQL —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –§—É–Ω–∫—Ü–∏—è `mysqli_real_escape_string()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö
   - Prepared statements —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `login.php`)

4. **–ö–ª–∞—Å—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–Ω–∞–π–¥–µ–Ω—ã, –Ω–æ –ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω—ã)**
   - `Escaper.php` - –∫–ª–∞—Å—Å –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML/JS/CSS/URL
   - `filter.php` - –∫–ª–∞—Å—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

#### 1. **–£—Å—Ç–∞—Ä–µ–≤—à–∞—è —Ñ—É–Ω–∫—Ü–∏—è `apicms_filter()`**
```php
// –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (apicms_system.php:58-71)
function apicms_filter($check){
    // –ü–†–û–ë–õ–ï–ú–ê: –°–º–µ—à–∏–≤–∞–µ—Ç SQL –∏ HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    $check = mysqli_real_escape_string($connect, $check);
    $check = htmlspecialchars($check, ENT_QUOTES, 'UTF-8'); // ‚ùå HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏!
    // ...
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –î–≤–æ–π–Ω–æ–µ HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ (–¥–∞–Ω–Ω—ã–µ —É–∂–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –≤ –ë–î)
- ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚ùå –î–∞–Ω–Ω—ã–µ –≤ –ë–î —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ HTML-—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- `apicms_filter()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ **68 –º–µ—Å—Ç–∞—Ö** (28 —Ñ–∞–π–ª–æ–≤)

#### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ Escaper –∏ Filter**
- –ö–ª–∞—Å—Å—ã `Escaper` –∏ `Filter` —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –Ω–æ **–ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω—ã** –≤ `apicms_system.php`
- –ù–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `display_html()`, `display_js()`, `display_url()`, `display_css()`
- –ù–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `cms_filter()` –∏–∑ –∫–ª–∞—Å—Å–∞ Filter

#### 3. **–ú–∞—Å—Å–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `htmlspecialchars()` –Ω–∞–ø—Ä—è–º—É—é**
- **434 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** `htmlspecialchars()` –≤ 88 —Ñ–∞–π–ª–∞—Ö
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å `Escaper`
- –†–∏—Å–∫ –∑–∞–±—ã—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –Ω–æ–≤—ã—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–µ—Å—Ç:**
```php
// modules/news.php:14-16
$name_safe = isset($newsone['name']) ? htmlspecialchars($newsone['name']) : '';
$txt_safe = isset($newsone['txt']) ? htmlspecialchars($newsone['txt']) : '';
$login_safe = isset($ank['login']) ? htmlspecialchars($ank['login']) : '';
```

#### 4. **SQL Injection —Ä–∏—Å–∫–∏**
- **248 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π** `mysqli_query()` –≤ 74 —Ñ–∞–π–ª–∞—Ö
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫
- Prepared statements –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–¥–∫–æ

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:**
```php
// api_forum/theme.php:21
mysqli_query($connect, "INSERT INTO `api_forum_post` (`text`, `id_user`, `theme`, `time`) VALUES ('".$text."', '".intval($user['id'])."', '".intval($theme_id)."', '".$time_now."')");

// api_core/apicms_system.php:79
$res = apicms_query($connect, "SELECT * FROM `users` WHERE `id` = '".$uid."' LIMIT 1");
```

#### 5. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã**
–°–ª–µ–¥—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã —É–ø–æ–º–∏–Ω–∞–ª–∏—Å—å, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ:
- ‚ùå `SessionService.php`
- ‚ùå `TokenGenerator.php`
- ‚ùå `Router.php`
- ‚ùå `Sanitizer.php`
- ‚ùå `CsrfGuard.php`

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

| –§—É–Ω–∫—Ü–∏—è/–ö–ª–∞—Å—Å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π | –§–∞–π–ª–æ–≤ | –°—Ç–∞—Ç—É—Å |
|--------------|-------------------------|--------|--------|
| `apicms_filter()` | 68 | 28 | ‚ùå –£—Å—Ç–∞—Ä–µ–≤—à–∞—è, —Å–º–µ—à–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ |
| `htmlspecialchars()` | 434 | 88 | ‚ùå –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –Ω–µ —á–µ—Ä–µ–∑ Escaper |
| `mysqli_query()` | 248 | 74 | ‚ö†Ô∏è –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –±–µ–∑ prepared statements |
| `mysqli_prepare()` | ~5 | 2-3 | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ |
| `display_html()` | 0 | 0 | ‚ùå –ö–ª–∞—Å—Å –µ—Å—Ç—å, –Ω–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω |
| `cms_filter()` | 0 | 0 | ‚ùå –ö–ª–∞—Å—Å –µ—Å—Ç—å, –Ω–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω |

---

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –°–º–µ—à–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π
```php
// –¢–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–ª–∞–µ—Ç –í–°–Å:
function apicms_filter($check){
    // 1. SQL —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    // 2. HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    // 3. –£–¥–∞–ª–µ–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
    // 4. Trim
}
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- `Filter` - —Ç–æ–ª—å–∫–æ –æ—á–∏—Å—Ç–∫–∞/–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `Escaper` - —Ç–æ–ª—å–∫–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ
- SQL —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ prepared statements –∏–ª–∏ `mysqli_real_escape_string()`

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ö–ª–∞—Å—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
- –ù–µ—Ç –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 3. –î–≤–æ–π–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–∞–Ω–Ω—ã–µ —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ `apicms_filter()`, –∞ –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ —á–µ—Ä–µ–∑ `htmlspecialchars()`:
```php
// –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:
$text = apicms_filter($_POST['text']); // HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω
mysqli_query($connect, "INSERT ... VALUES ('$text')"); // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º

// –ü—Ä–∏ –≤—ã–≤–æ–¥–µ:
echo htmlspecialchars($row['text']); // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ï–©–Å –†–ê–ó ‚Üí &amp;lt;script&amp;gt;
```

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å)

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π:

```
INPUT (–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
  ‚Üì
Filter::sanitize() - –æ—á–∏—Å—Ç–∫–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤
  ‚Üì
SQL —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - mysqli_real_escape_string() –∏–ª–∏ prepared statements
  ‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (–ß–ò–°–¢–´–ï –¥–∞–Ω–Ω—ã–µ, –±–µ–∑ HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!)
  ‚Üì
OUTPUT (–í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö)
  ‚Üì
Escaper::escapeHtml() - —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¢–û–õ–¨–ö–û –ø—Ä–∏ –≤—ã–≤–æ–¥–µ
  ‚Üì
–í—ã–≤–æ–¥ –≤ HTML
```

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow:

```php
// 1. –í–•–û–î (INPUT)
$name = cms_filter($_POST['name'], 'string');
$age = cms_filter($_POST['age'], 'int');

// 2. SQL —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Ç–¥–µ–ª—å–Ω–æ)
$stmt = mysqli_prepare($connect, "INSERT INTO users (name, age) VALUES (?, ?)");
mysqli_stmt_bind_param($stmt, 'si', $name, $age);

// 3. –í–´–•–û–î (OUTPUT)
echo '<div>' . display_html($user['name']) . '</div>';
echo '<div>–í–æ–∑—Ä–∞—Å—Ç: ' . $user['age'] . '</div>';
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª–∞—Å—Å—ã Escaper –∏ Filter**
   - –î–æ–±–∞–≤–∏—Ç—å `require_once` –≤ `apicms_system.php`
   - –°–æ–∑–¥–∞—Ç—å —Ö–µ–ª–ø–µ—Ä—ã `display_html()`, `display_js()`, `display_url()`, `display_css()`
   - –°–æ–∑–¥–∞—Ç—å —Ö–µ–ª–ø–µ—Ä—ã `cms_filter()`, `cms_filter_array()`

2. **–ó–∞–º–µ–Ω–∏—Ç—å `apicms_filter()` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**
   - –†–∞–∑–¥–µ–ª–∏—Ç—å SQL –∏ HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cms_filter()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `display_html()` –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–≤–æ–¥–∞

3. **–£–±—Ä–∞—Ç—å HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏**
   - –î–∞–Ω–Ω—ã–µ –≤ –ë–î –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ
   - –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):

4. **–í–Ω–µ–¥—Ä–∏—Ç—å Prepared Statements**
   - –ó–∞–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ –Ω–∞ prepared statements
   - –û—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è INSERT/UPDATE –∑–∞–ø—Ä–æ—Å–æ–≤

5. **–ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `htmlspecialchars()`**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `display_html()` –≤–µ–∑–¥–µ
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–æ–π —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ):

6. **–°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–ª–∞—Å—Å—ã**
   - `SessionService` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏
   - `TokenGenerator` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
   - `CsrfGuard` –¥–ª—è CSRF –∑–∞—â–∏—Ç—ã
   - `Router` –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

7. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Filter::sanitize()` —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ (int, float, bool, string)

---

## üìù –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª–∞—Å—Å—ã `Escaper` –∏ `Filter` –≤ `apicms_system.php`
2. –°–æ–∑–¥–∞—Ç—å —Ö–µ–ª–ø–µ—Ä—ã `display_*()` –∏ `cms_filter()`
3. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `apicms_sql_escape()` —Ç–æ–ª—å–∫–æ –¥–ª—è SQL (–±–µ–∑ HTML)

### –≠—Ç–∞–ø 2: –ú–∏–≥—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
1. –ó–∞–º–µ–Ω–∏—Ç—å `apicms_filter()` –Ω–∞ `cms_filter()` –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. –î–æ–±–∞–≤–∏—Ç—å SQL —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `mysqli_real_escape_string()` –∏–ª–∏ prepared statements
3. –£–¥–∞–ª–∏—Ç—å HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –≠—Ç–∞–ø 3: –ú–∏–≥—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
1. –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `htmlspecialchars()` –Ω–∞ `display_html()`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î

### –≠—Ç–∞–ø 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL
1. –í–Ω–µ–¥—Ä–∏—Ç—å prepared statements –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. –û—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è INSERT/UPDATE —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

## üîí –¢–µ–∫—É—â–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫:

1. **SQL Injection** (–ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –≤ SQL –∑–∞–ø—Ä–æ—Å–∞—Ö
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prepared statements

2. **XSS (Cross-Site Scripting)**
   - –î–≤–æ–π–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞ –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

3. **–î–≤–æ–π–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –î–∞–Ω–Ω—ã–µ –≤ –ë–î —Ö—Ä–∞–Ω—è—Ç—Å—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
   - –ü—Ä–∏ –≤—ã–≤–æ–¥–µ —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è –µ—â—ë —Ä–∞–∑
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: `&lt;script&gt;` –≤–º–µ—Å—Ç–æ `<script>`

### –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫:

4. **CSRF** (—á–∞—Å—Ç–∏—á–Ω–æ –∑–∞—â–∏—â–µ–Ω–æ)
   - –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤**
   - –î–∞–Ω–Ω—ã–µ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –Ω—É–∂–Ω—ã–º —Ç–∏–ø–∞–º
   - –†–∏—Å–∫ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------------|------------------|
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prepared statements | ~2% | 80%+ |
| –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | 0% | 100% |
| –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π | ‚ùå | ‚úÖ |
| –ö–ª–∞—Å—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã | 0/2 | 2/2 |

---

## üéì –í—ã–≤–æ–¥—ã

1. **–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É**, –Ω–æ —É—Å—Ç–∞—Ä–µ–ª –≤ –ø–ª–∞–Ω–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. **–ö–ª–∞—Å—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω—ã**, –Ω–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
3. **–¢–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `apicms_filter()` —è–≤–ª—è–µ—Ç—Å—è –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–º** - —Å–º–µ—à–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
4. **–¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è** –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º Filter/Escaper
5. **SQL –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** - –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ prepared statements

---

## üìå –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω
2. ‚è≥ –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª–∞—Å—Å—ã Escaper –∏ Filter
3. ‚è≥ –°–æ–∑–¥–∞—Ç—å —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
4. ‚è≥ –ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π (login, registration, admin)
5. ‚è≥ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ –≤—Å–µ—Ö `htmlspecialchars()` –Ω–∞ `display_html()`

---

*–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: 2024*  
*–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞: ApiCMS 3.0*

